{% extends 'base.html' %}

{% block title %}D·ª± ƒëo√°n b·ªánh tim - Health Prediction System{% endblock %}

{% block content %}
<div class="form-container">
    <h2 class="form-title">‚ù§Ô∏è D·ª± ƒëo√°n nguy c∆° b·ªánh tim</h2>
    
    <form action="/heart" method="post" id="heart-form">
        <div class="form-row">
            <div class="form-group">
                <label for="Age">Tu·ªïi:</label>
                <input type="text" id="Age" name="Age" placeholder="VD: 40" required>
            </div>
            <div class="form-group">
                <label for="Sex">Gi·ªõi t√≠nh:</label>
                <select id="Sex" name="Sex" required>
                    <option value="">Ch·ªçn gi·ªõi t√≠nh</option>
                    <option value="M">Nam</option>
                    <option value="F">N·ªØ</option>
                </select>
            </div>
        </div>
        
        <div class="form-group">
            <label for="ChestPainType">Lo·∫°i ƒëau ng·ª±c:</label>
            <select id="ChestPainType" name="ChestPainType" required>
                <option value="">Ch·ªçn lo·∫°i ƒëau ng·ª±c</option>
                <option value="ATA">ATA - ƒêau ng·ª±c ƒëi·ªÉn h√¨nh</option>
                <option value="NAP">NAP - ƒêau ng·ª±c kh√¥ng ƒëi·ªÉn h√¨nh</option>
                <option value="ASY">ASY - Kh√¥ng ƒëau ng·ª±c</option>
                <option value="TA">TA - ƒêau ng·ª±c kh√¥ng ·ªïn ƒë·ªãnh</option>
            </select>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="RestingBP">Huy·∫øt √°p ngh·ªâ (mmHg):</label>
                <input type="text" id="RestingBP" name="RestingBP" placeholder="VD: 140" required>
            </div>
            <div class="form-group">
                <label for="Cholesterol">Cholesterol (mg/dl):</label>
                <input type="text" id="Cholesterol" name="Cholesterol" placeholder="VD: 289" required>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="FastingBS">ƒê∆∞·ªùng huy·∫øt l√∫c ƒë√≥i:</label>
                <select id="FastingBS" name="FastingBS" required>
                    <option value="">Ch·ªçn</option>
                    <option value="0">‚â§ 120 mg/dl</option>
                    <option value="1">> 120 mg/dl</option>
                </select>
            </div>
            <div class="form-group">
                <label for="RestingECG">ECG ngh·ªâ:</label>
                <select id="RestingECG" name="RestingECG" required>
                    <option value="">Ch·ªçn</option>
                    <option value="Normal">B√¨nh th∆∞·ªùng</option>
                    <option value="ST">ST-T wave abnormality</option>
                    <option value="LVH">Left ventricular hypertrophy</option>
                </select>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="MaxHR">Nh·ªãp tim t·ªëi ƒëa:</label>
                <input type="text" id="MaxHR" name="MaxHR" placeholder="VD: 172" required>
            </div>
            <div class="form-group">
                <label for="ExerciseAngina">ƒêau th·∫Øt ng·ª±c khi t·∫≠p:</label>
                <select id="ExerciseAngina" name="ExerciseAngina" required>
                    <option value="">Ch·ªçn</option>
                    <option value="Y">C√≥</option>
                    <option value="N">Kh√¥ng</option>
                </select>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="Oldpeak">Oldpeak:</label>
                <input type="text" id="Oldpeak" name="Oldpeak" placeholder="VD: 0.0" required>
            </div>
            <div class="form-group">
                <label for="ST_Slope">ƒê·ªô d·ªëc ST:</label>
                <select id="ST_Slope" name="ST_Slope" required>
                    <option value="">Ch·ªçn</option>
                    <option value="Up">TƒÉng</option>
                    <option value="Flat">Ph·∫≥ng</option>
                    <option value="Down">Gi·∫£m</option>
                </select>
            </div>
        </div>
        
        <button type="submit">üîç D·ª± ƒëo√°n</button>
    </form>

    {% if prediction_text %}
    <div class="result 
        {% if 'L·ªói' in prediction_text %}error
        {% elif 'nguy c∆° m·∫Øc' in prediction_text %}warning  
        {% else %}success{% endif %}">
        <strong>K·∫øt qu·∫£:</strong> {{ prediction_text }}
    </div>
    {% endif %}
    
    <div class="sample-data">
        <strong>üìù D·ªØ li·ªáu m·∫´u ƒë·ªÉ test:</strong><br>
        <strong>Tr∆∞·ªùng h·ª£p b√¨nh th∆∞·ªùng:</strong> 40, M, ATA, 140, 289, 0, Normal, 172, N, 0, Up<br>
        <strong>Tr∆∞·ªùng h·ª£p c√≥ nguy c∆°:</strong> 54, M, NAP, 150, 195, 0, Normal, 122, N, 0, Up
    </div>
</div>

<script>
    // Auto-fill sample data
    function fillSample(type) {
        const inputs = document.querySelectorAll('input[type="text"], select');
        let sampleData;
        
        if (type === 'normal') {
            sampleData = ['40', 'M', 'ATA', '140', '289', '0', 'Normal', '172', 'N', '0', 'Up'];
        } else {
            sampleData = ['54', 'M', 'NAP', '150', '195', '0', 'Normal', '122', 'N', '0', 'Up'];
        }
        
        inputs.forEach((input, index) => {
            if (index < sampleData.length) {
                input.value = sampleData[index];
                input.style.borderColor = '#28a745';
            }
        });
    }
    
    // Add sample buttons
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('heart-form');
        const buttonDiv = document.createElement('div');
        buttonDiv.style.marginBottom = '15px';
        buttonDiv.innerHTML = `
            <button type="button" onclick="fillSample('normal')" style="width: 48%; margin-right: 4%; background: #28a745;">üìù M·∫´u b√¨nh th∆∞·ªùng</button>
            <button type="button" onclick="fillSample('risk')" style="width: 48%; background: #ffc107; color: #333;">‚ö†Ô∏è M·∫´u c√≥ nguy c∆°</button>
        `;
        form.insertBefore(buttonDiv, form.querySelector('button[type="submit"]'));
    });
    
    // Validation
    document.getElementById('heart-form').addEventListener('submit', function(e) {
        const inputs = this.querySelectorAll('input[required], select[required]');
        let allValid = true;
        
        inputs.forEach(input => {
            const value = input.value.trim();
            if (!value) {
                allValid = false;
                input.style.borderColor = '#dc3545';
            } else if (input.type === 'text' && isNaN(value)) {
                allValid = false;
                input.style.borderColor = '#dc3545';
            } else {
                input.style.borderColor = '#28a745';
            }
        });
        
        if (!allValid) {
            e.preventDefault();
            alert('‚ùå Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin h·ª£p l·ªá!');
        }
    });
</script>
{% endblock %} 