{% extends 'base.html' %}
{% block title %}Sản phẩm - Health Prediction System{% endblock %}
{% block content %}
<div class="form-container" style="max-width: 1000px;">
    <h2 class="form-title">🛒 Sản phẩm hỗ trợ sức khỏe</h2>
    
    <div style="margin-bottom: 30px;">
        <h3 style="color: #667eea; margin-bottom: 20px; text-align: center;">🩺 Sản phẩm cho người tiểu đường</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
            {% for product in diabetes_products %}
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center;">
                <img src="{{ product.image_url }}" alt="{{ product.name }}" style="width: 100%; height: 150px; object-fit: cover; border-radius: 8px; margin-bottom: 15px;">
                <h4 style="color: #333; margin-bottom: 10px;">{{ product.name }}</h4>
                <p style="color: #666; margin-bottom: 15px; line-height: 1.5;">
                    {{ product.description }}
                </p>
                <div style="color: #e74c3c; font-size: 1.2em; font-weight: bold; margin-bottom: 15px;">
                    ₫{{ "{:,.0f}".format(product.price) }}
                </div>
                <button style="background: #e74c3c; width: 100%;" onclick="alert('Chức năng mua hàng đang được phát triển!')">🛒 Mua ngay</button>
            </div>
            {% endfor %}
        </div>
    </div>

    <div style="margin-bottom: 30px;">
        <h3 style="color: #667eea; margin-bottom: 20px; text-align: center;">❤️ Sản phẩm cho người bệnh tim</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
            {% for product in heart_products %}
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center;">
                <img src="{{ product.image_url }}" alt="{{ product.name }}" style="width: 100%; height: 150px; object-fit: cover; border-radius: 8px; margin-bottom: 15px;">
                <h4 style="color: #333; margin-bottom: 10px;">{{ product.name }}</h4>
                <p style="color: #666; margin-bottom: 15px; line-height: 1.5;">
                    {{ product.description }}
                </p>
                <div style="color: #e74c3c; font-size: 1.2em; font-weight: bold; margin-bottom: 15px;">
                    ₫{{ "{:,.0f}".format(product.price) }}
                </div>
                <button style="background: #e74c3c; width: 100%;" onclick="alert('Chức năng mua hàng đang được phát triển!')">🛒 Mua ngay</button>
            </div>
            {% endfor %}
        </div>
    </div>

    <div style="background: #e8f4fd; padding: 20px; border-radius: 10px; border-left: 5px solid #667eea;">
        <h4 style="color: #333; margin-bottom: 15px;">🎁 Ưu đãi đặc biệt</h4>
        <ul style="color: #555; line-height: 1.6; margin: 0;">
            <li>🚚 <strong>Miễn phí vận chuyển</strong> cho đơn hàng trên 500,000đ</li>
            <li>🔄 <strong>Đổi trả miễn phí</strong> trong 30 ngày</li>
            <li>📞 <strong>Tư vấn miễn phí</strong> từ chuyên gia y tế</li>
            <li>🎯 <strong>Bảo hành chính hãng</strong> 12 tháng</li>
        </ul>
    </div>

    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107; margin-top: 20px;">
        <p style="color: #856404; margin: 0; font-size: 14px; text-align: center;">
            <strong>💡 Lưu ý:</strong> Sản phẩm chỉ mang tính chất hỗ trợ, không thay thế thuốc điều trị. Vui lòng tham khảo ý kiến bác sĩ trước khi sử dụng.
        </p>
    </div>
</div>

<!-- Modal Mua hàng -->
<div id="buyModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
    <div style="position: relative; background: white; max-width: 500px; margin: 50px auto; padding: 20px; border-radius: 10px;">
        <h3 style="margin-bottom: 20px;">🛒 Đặt hàng</h3>
        <form id="buyForm" method="POST" style="display: flex; flex-direction: column; gap: 15px;">
            <div>
                <label style="display: block; margin-bottom: 5px;">Tên sản phẩm:</label>
                <input type="text" id="productName" readonly style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
            </div>
            
            <div>
                <label style="display: block; margin-bottom: 5px;">Số lượng:</label>
                <input type="number" name="quantity" value="1" min="1" onchange="updateTotal()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
            </div>
            
            <div>
                <label style="display: block; margin-bottom: 5px;">Thành tiền:</label>
                <input type="text" id="totalAmount" readonly style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
            </div>
            
            <div>
                <label style="display: block; margin-bottom: 5px;">Họ tên người nhận:</label>
                <input type="text" name="full_name" value="{{ user.full_name if user }}" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
            </div>
            
            <div>
                <label style="display: block; margin-bottom: 5px;">Số điện thoại:</label>
                <input type="tel" name="phone" value="{{ user.phone if user }}" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
            </div>
            
            <div>
                <label style="display: block; margin-bottom: 5px;">Địa chỉ nhận hàng:</label>
                <textarea name="address" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; min-height: 80px;">{{ user.address if user }}</textarea>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button type="button" onclick="hideBuyForm()" style="padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">Hủy</button>
                <button type="submit" style="padding: 10px 20px; background: #e74c3c; color: white; border: none; border-radius: 5px; cursor: pointer;">Đặt hàng</button>
            </div>
        </form>
    </div>
</div>

<script>
let currentProduct = null;

function showBuyForm(productId, productName, price) {
    currentProduct = { id: productId, name: productName, price: price };
    document.getElementById('buyModal').style.display = 'block';
    document.getElementById('productName').value = productName;
    document.getElementById('buyForm').action = '/buy/' + productId;
    updateTotal();
}

function hideBuyForm() {
    document.getElementById('buyModal').style.display = 'none';
}

function updateTotal() {
    if (!currentProduct) return;
    const quantity = document.querySelector('input[name="quantity"]').value;
    const total = currentProduct.price * quantity;
    document.getElementById('totalAmount').value = '₫' + total.toLocaleString('vi-VN');
}

// Đóng modal khi click bên ngoài
window.onclick = function(event) {
    const modal = document.getElementById('buyModal');
    if (event.target == modal) {
        hideBuyForm();
    }
}
</script>
{% endblock %} 